<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="hieudhse184340@fpt.edu.vn"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 3 :: Internship Report</title> <link href=../../css/nucleus.css?1765279076 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765279076 rel=stylesheet><link href=../../css/hybrid.css?1765279076 rel=stylesheet><link href=../../css/featherlight.min.css?1765279076 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765279076 rel=stylesheet><link href=../../css/auto-complete.css?1765279076 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765279076 rel=stylesheet><link href=../../css/theme.css?1765279076 rel=stylesheet><link href=../../css/hugo-theme.css?1765279076 rel=stylesheet><link href=../../css/theme-workshop.css?1765279076 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765279076></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.3-blog3/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label> <input data-search-input id=search-by type=search placeholder=Search...> <span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765279076></script><script type=text/javascript src=../../js/auto-complete.js?1765279076></script><script type=text/javascript>var baseurl="https://hd-2004.github.io/AWS_Fall2025_Workshop/"</script><script type=text/javascript src=../../js/search.js?1765279076></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class=dd-item><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class="dd-item
active"><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.5-event5/ title="Event 5" class=dd-item><a href=../../4-eventparticipated/4.5-event5/><b>4.5. </b>Event 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-create-amplify/ title="Create Amplify backend" class=dd-item><a href=../../5-workshop/5.3-create-amplify/><b>5.3. </b>Create Amplify backend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-aws-cognito/ title="Configure AWS Cognito" class=dd-item><a href=../../5-workshop/5.4-aws-cognito/>5.4. Configure AWS Cognito
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-create-ses/ title="Configure Amazon SES for email" class=dd-item><a href=../../5-workshop/5.5-create-ses/><b>5.5. </b>Configure Amazon SES for email
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-create-cloudwatch/ title="Configure Amazon CloudWatch" class=dd-item><a href=../../5-workshop/5.6-create-cloudwatch/><b>5.6. </b>Configure Amazon CloudWatch
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.7-create-iam-roles-policies/ title="Create IAM Roles-Policies" class=dd-item><a href=../../5-workshop/5.7-create-iam-roles-policies/><b>5.7. </b>Create IAM Roles-Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.8-route-53/ title="Configure Amazon Route 53" class=dd-item><a href=../../5-workshop/5.8-route-53/><b>5.8. </b>Configure Amazon Route 53
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.9-cleanup/ title="Clean up" class=dd-item><a href=../../5-workshop/5.9-cleanup/><b>5.9. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Feedback & Suggestions" class=dd-item><a href=../../7-feedback/><b>7. </b>Feedback & Suggestions
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://hd-2004.github.io/AWS_Fall2025_Workshop/3-blogstranslated/3.3-blog3/ selected>English</option><option id=vi value=https://hd-2004.github.io/AWS_Fall2025_Workshop/vi/3-blogstranslated/3.3-blog3/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i> </a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span> <span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 3</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#introduction>Introduction:</a></li><li><a href=#introduction-to-lambda-hooks>Introduction to Lambda Hooks:</a></li><li><a href=#solution-overview>Solution Overview:</a></li><li><a href=#architecture>Architecture:</a></li><li><a href=#prerequisites>Prerequisites:</a></li><li><a href=#procedure>Procedure:</a></li><li><a href=#creating-the-validation-lambda--lambda-definition-in-cloudformation>Creating the Validation Lambda – Lambda Definition in CloudFormation</a></li><li><a href=#creating-the-cloudformation-lambda-hook>Creating the CloudFormation Lambda Hook</a></li><li><a href=#configuring-compliant-runtimes---using-systems-manager-parameter-store>Configuring Compliant Runtimes - Using Systems Manager Parameter Store</a></li><li><a href=#deploying-the-solution>Deploying the Solution</a></li><li><a href=#testing-the-lambda-hook>Testing the Lambda Hook</a></li><li><a href=#cleaning-up-resources>Cleaning Up Resources:</a></li><li><a href=#conclusion>Conclusion:</a></li><li><a href=#about-the-authors>About the Authors:</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 3</h1><h1 id=validate-your-lambda-runtime-with-cloudformation-lambda-hooks>Validate Your Lambda Runtime with CloudFormation Lambda Hooks</h1><p>(Validate your Lambda runtime environment using Lambda Hooks in CloudFormation.)</p><p>Author: Matteo Luigi Restelli and Stella Hie | April 02, 2025 | In AWS CloudFormation, AWS Lambda, Configuration, compliance, and auditing, DevOps, Intermediate (200), Learning Levels, Management & Governance, Management Tools</p><h3 id=introduction>Introduction:</h3><p>This article illustrates how to leverage AWS CloudFormation Lambda Hooks to enforce compliance rules during resource initialization, allowing you to evaluate and validate the configuration of Lambda functions against custom policies before deployment. Typically, these policies affect how software is built, such as limiting language versions or runtimes. A prime example is applying these policies to AWS Lambda — the serverless compute service that allows code to run without the need to provide or manage servers. While AWS Lambda automatically handles the deprecation of runtimes, preventing you from deploying unsupported runtimes, some organizations still need to define and enforce their own compliance rules — rules that aren&rsquo;t directly related to deprecating a specific language version.</p><h3 id=introduction-to-lambda-hooks>Introduction to Lambda Hooks:</h3><p>AWS CloudFormation Lambda Hooks are a powerful feature that allows developers to evaluate CloudFormation and AWS Cloud Control API operations via custom code deployed as Lambda functions. This capability enables proactive evaluation of resource configurations before initialization, thereby enhancing security, compliance, and operational efficiency.</p><p>Lambda Hooks provide a mechanism to intercept and evaluate a wide range of operations within AWS CloudFormation, including resource operations, stack operations, and change sets (this feature can also be used with the Cloud Control API, but this article focuses on CloudFormation). When you trigger a Lambda Hook, CloudFormation registers an entry in your account&rsquo;s registry as a Private Hook, allowing you to configure the hook for specific AWS accounts and regions. During the Lambda Hooks configuration process, you can specify one or more Lambda functions to be invoked during the evaluation process. These functions can reside in the same account and region as the Hook, or in a different account (as long as the proper access permissions are set up). The evaluation occurs at specific points in the CloudFormation Stack lifecycle — such as during stack creation, update, or deletion. At these points, the configured Lambda functions are called to evaluate the proposed changes based on the compliance rules you have defined. Based on the evaluation results, the hook can either block the operation or trigger a warning, allowing the operation to proceed.</p><p>Lambda Hooks allow for proactive evaluation of resources before they are initialized by CloudFormation, creating a governance layer. This means non-compliant resources are detected and blocked before deployment, rather than needing to be fixed afterward. By leveraging Lambda Hooks, organizations can automate and standardize compliance checks across all AWS accounts and regions, ensuring consistency and reducing the burden of manual management.</p><h3 id=solution-overview>Solution Overview:</h3><p>The following sections demonstrate a practical use case of AWS CloudFormation Lambda Hooks, focusing on enforcing compliance rules for AWS Lambda runtimes.</p><p>Introducing AnyCompany — a pioneering company with strict compliance rules in software development. Among these rules is a strict policy on the use of specific AWS Lambda runtimes.</p><p>As AnyCompany continues to transition to a serverless architecture, they face a challenge: how to prevent the deployment of Lambda functions using non-compliant runtimes. Since this company uses AWS CloudFormation to deploy Lambda functions, AnyCompany seeks to leverage the power of AWS CloudFormation Lambda Hooks to solve this problem.</p><p>We will explore the setup process, demonstrate how the Hook works, and discuss the broader implications of maintaining compliance in a dynamic cloud computing environment.</p><h3 id=architecture>Architecture:</h3><p>The architecture diagram below illustrates how the Lambda Hook is deployed. In this model, AWS CloudFormation Lambda Hooks are used to intercept the deployment of Lambda functions and perform compliance checks on those resources.</p><p>The Lambda Hook interacts with another AWS Lambda function, responsible for performing compliance checks.</p><p>Finally, the system uses AWS Systems Manager Parameter Store to store a configuration parameter containing a list of permitted Lambda runtimes.</p><ol><li><p>A developer (or CI/CD pipeline) deploys a CloudFormation Stack that includes Lambda functions.</p></li><li><p>CloudFormation will call the corresponding Lambda Hook, which is configured to intercept AWS Lambda-related resource operations. In this case, the hook is set up to &ldquo;FAIL&rdquo; the deployment process if the compliance checks fail.</p></li><li><p>The Lambda Hook checks if the runtime of the Lambda function complies with the company’s regulations. To do this, it compares the runtime of the Lambda function against the list of permitted runtimes, which is stored as a Parameter in AWS Systems Manager Parameter Store. Note that in this example, SSM Parameter Store is used to store the configuration, but other services such as Amazon DynamoDB, AWS Secrets Manager, or AppConfig could be used as well.</p></li><li><p>After checking the runtime’s compliance, the Lambda Hook responds as follows:</p><ul><li>Failure: if the Lambda runtime does not comply with the policy.</li><li>Success: if the Lambda runtime complies with the company’s policy.</li></ul></li><li><p>Based on the Lambda Hook’s response, the CloudFormation deployment process will either continue or be stopped.</p></li></ol><ul><li><strong>hook-lambda</strong>: a directory containing all source code related to the CloudFormation Lambda Hook, including the Lambda function used for validation (Validation Lambda Function) and the CloudFormation template.</li><li><strong>sample</strong>: a directory containing sample code used to test the CloudFormation Lambda Hook.</li><li><strong>deploy.sh</strong>: a utility script used to deploy the solution via the AWS CLI.</li><li><strong>cleanup.sh</strong>: a utility script used to clean up the infrastructure — CloudFormation Hook on AWS via AWS CLI.</li><li><strong>template.yml</strong>: the CloudFormation template file (AWS CloudFormation Template) containing all the AWS resources used in this solution.</li></ul><h3 id=prerequisites>Prerequisites:</h3><p>You must meet the following prerequisites for the solution:</p><ul><li><p>AWS Account — or sign up to create and activate a new AWS account.</p></li><li><p>Software required on the development machine:</p><ul><li>Install the AWS Command Line Interface (AWS CLI) and configure it to connect to your AWS account.</li><li>Install Node.js and use a package manager like npm.</li><li>Appropriate AWS credentials to interact with the resources in your AWS account.</li></ul></li></ul><h3 id=procedure>Procedure:</h3><h4 id=create-the-aws-lambda-validation-function--lambda-code>Create the AWS Lambda Validation Function – Lambda Code</h4><p>The CloudFormation Lambda Hook will interact with a specific Lambda function (referred to as the Validation Lambda for the rest of the article). This function will be invoked during the CloudFormation CREATE or UPDATE STACK operations involving Lambda functions. The goal is to check whether these Lambda functions are using a runtime that complies with AnyCompany&rsquo;s policies.</p><p>Here’s a detailed description of the steps the Validation Lambda function handler performs (the code is written in TypeScript):</p><p>The Validation Lambda first retrieves the value of an environment variable — this variable contains the parameter name in AWS Systems Manager Parameter Store where the list of compliant runtimes is stored.
Next, the function performs safety checks to ensure that only Lambda resources are considered. It also ensures that the Lambda function&rsquo;s Runtime property is explicitly defined.</p><p>Note: The two safety checks above could theoretically be skipped, as the Hook is already configured to interact only with Lambda resources, and the Lambda Runtime property is always required. However, these checks are kept to demonstrate how to extract information from the Lambda Hook event in your handler.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>parameterName</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>process</span>.<span style=color:#a6e22e>env</span>.<span style=color:#a6e22e>PERMITTED_RUNTIMES_PARAM</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>parameterName</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#39;Permitted Runtimes Parameter is not set&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>resourceProperties</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>requestData</span>.<span style=color:#a6e22e>targetModel</span>.<span style=color:#a6e22e>resourceProperties</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// Check if this is a Lambda function resource
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>event</span>.<span style=color:#a6e22e>requestData</span>.<span style=color:#a6e22e>targetType</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;AWS::Lambda::Function&#39;</span>) {
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Resource is not a Lambda function, skipping&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>hookStatus</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SUCCESS&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Not a Lambda function resource, skipping validation&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>clientRequestToken</span>: <span style=color:#66d9ef>event.clientRequestToken</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Check runtime version compliance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>runtime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>resourceProperties</span>.<span style=color:#a6e22e>Runtime</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>runtime</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Runtime not defined, failing&#34;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>hookStatus</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;FAILURE&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>errorCode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;NonCompliant&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Runtime is required for Lambda functions&#39;</span>,
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>clientRequestToken</span>: <span style=color:#66d9ef>event.clientRequestToken</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Next, the <strong>Validation Lambda</strong> will retrieve the configuration parameter value from the AWS Systems Manager Parameter Store through a utility class called <code>ParameterStoreService</code>. In the example presented in this article, the value inside the configuration parameter is a list of strings, where each string represents a valid AWS Lambda runtime value, such as:</p><p><code>nodejs22.x</code>, <code>nodejs20.x</code>, <code>python3.11</code>, <code>python3.10</code>, <code>java17</code>, <code>java11</code>, <code>dotnet6</code></p><p>Once this value is retrieved, the Validation Lambda will check if the runtime of the Lambda resource being deployed is within the list of permitted runtimes. If the runtime is non-compliant, the function will return a correctly formatted response with <code>hookStatus = FAILURE</code>. If the runtime is compliant, the response will contain <code>hookStatus = SUCCESS</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// Retrieve configuration from Parameter Store
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>compliantRuntimes</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>parameterStoreService</span>.<span style=color:#a6e22e>getParameterFromStore</span>(<span style=color:#a6e22e>parameterName</span>);
</span></span><span style=display:flex><span><span style=color:#75715e>// Check if Lambda runtime is permitted or not
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>compliantRuntimes</span>.<span style=color:#a6e22e>includes</span>(<span style=color:#a6e22e>runtime</span>)) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#34;Runtime &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>runtime</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34; not compliant &#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>hookStatus</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;FAILURE&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>errorCode</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;NonCompliant&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>`Runtime </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>runtime</span><span style=color:#e6db74>}</span><span style=color:#e6db74> is not compliant. Please use one of: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>compliantRuntimes</span>.<span style=color:#a6e22e>join</span>(<span style=color:#e6db74>&#39;, &#39;</span>)<span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>clientRequestToken</span>: <span style=color:#66d9ef>event.clientRequestToken</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>hookStatus</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;SUCCESS&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>message</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Runtime version compliance check passed&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>clientRequestToken</span>: <span style=color:#66d9ef>event.clientRequestToken</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>For more information on possible response values of CloudFormation Lambda Hooks, you can refer to the provided link.</p><h3 id=creating-the-validation-lambda--lambda-definition-in-cloudformation>Creating the Validation Lambda – Lambda Definition in CloudFormation</h3><p>The <strong>Validation Lambda</strong> will be deployed through CloudFormation, alongside the CloudFormation Lambda Hook definition and the AWS Systems Manager Parameter Store parameter. Below is a fragment of the CloudFormation template describing the configuration for the Validation Lambda:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Lambda Function</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ValidationFunction</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Lambda::Function</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>index.handler</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Role</span>: !<span style=color:#ae81ff>GetAtt LambdaExecutionRole.Arn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Code</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>S3Bucket</span>: !<span style=color:#ae81ff>Ref DeploymentBucket</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>S3Key</span>: <span style=color:#ae81ff>hook-lambda.zip</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>nodejs22.x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Timeout</span>: <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>MemorySize</span>: <span style=color:#ae81ff>128</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Environment</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Variables</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>PERMITTED_RUNTIMES_PARAM</span>: !<span style=color:#ae81ff>Ref ParameterStoreParamName</span>
</span></span></code></pre></div><p>You need to assign the Lambda function an IAM (IAM role) with the appropriate permissions to access the parameter in the AWS Systems Manager Parameter Store.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Lambda Function Role</span>
</span></span><span style=display:flex><span><span style=color:#f92672>LambdaExecutionRole</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::IAM::Role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>AssumeRolePolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Principal</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>Service</span>: <span style=color:#ae81ff>lambda.amazonaws.com</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Action</span>: <span style=color:#ae81ff>sts:AssumeRole</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ManagedPolicyArns</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># IAM Policy to access Parameter Store</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ParameterStoreAccessPolicy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::IAM::RolePolicy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>RoleName</span>: !<span style=color:#ae81ff>Ref LambdaExecutionRole</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>PolicyName</span>: <span style=color:#ae81ff>ParameterStoreAccess</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>PolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Action</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>ssm:GetParameter</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Resource</span>: !<span style=color:#ae81ff>Sub arn:aws:ssm:${AWS::Region}:${AWS::AccountId}:parameter${ParameterStoreParamName}</span>
</span></span></code></pre></div><h3 id=creating-the-cloudformation-lambda-hook>Creating the CloudFormation Lambda Hook</h3><p>At this step, you will create a CloudFormation Lambda Hook that meets the following requirements:</p><ul><li>Activated during the <strong>CREATE</strong> and <strong>UPDATE</strong> phases of CloudFormation.</li><li>Only considers resources of type <code>AWS::Lambda::Function</code>.</li><li>Executes during the “<strong>Pre-Provisioning</strong>” phase of the CloudFormation template (i.e., before resources are initialized).</li><li>Applies to both <strong>Stack</strong> and <strong>Resource</strong> operations.</li><li>Calls the previously defined <strong>Validation Lambda</strong> function.</li></ul><p>Here’s the corresponding definition in the CloudFormation template:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Lambda Hook</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ValidationHook</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::CloudFormation::LambdaHook</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Alias</span>: <span style=color:#ae81ff>Private::Lambda::LambdaResourcesComplianceValidationHook</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>LambdaFunction</span>: !<span style=color:#ae81ff>GetAtt ValidationFunction.Arn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ExecutionRole</span>: !<span style=color:#ae81ff>GetAtt HookExecutionRole.Arn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>FailureMode</span>: <span style=color:#ae81ff>FAIL</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>HookStatus</span>: <span style=color:#ae81ff>ENABLED</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>TargetFilters</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Actions</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>CREATE</span>
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>UPDATE</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>InvocationPoints</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>PRE_PROVISION</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>TargetNames</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>AWS::Lambda::Function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>TargetOperations</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>RESOURCE</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>STACK</span>
</span></span></code></pre></div><p>Please note that the CloudFormation template above references an IAM role, as the Hook needs the proper permissions to invoke the target Lambda function. Below is the definition for the IAM role:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Hook Execution Role</span>
</span></span><span style=display:flex><span><span style=color:#f92672>HookExecutionRole</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::IAM::Role</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>AssumeRolePolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Principal</span>:
</span></span><span style=display:flex><span>            <span style=color:#f92672>Service</span>: <span style=color:#ae81ff>hooks.cloudformation.amazonaws.com</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Action</span>: <span style=color:#ae81ff>sts:AssumeRole</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># IAM Policy for Lambda Invocation</span>
</span></span><span style=display:flex><span><span style=color:#f92672>LambdaInvokePolicy</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::IAM::RolePolicy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>RoleName</span>: !<span style=color:#ae81ff>Ref HookExecutionRole</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>PolicyName</span>: <span style=color:#ae81ff>LambdaInvokePolicy</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>PolicyDocument</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>Version</span>: <span style=color:#e6db74>&#34;2012-10-17&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>Statement</span>:
</span></span><span style=display:flex><span>        - <span style=color:#f92672>Effect</span>: <span style=color:#ae81ff>Allow</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Action</span>:
</span></span><span style=display:flex><span>            - <span style=color:#ae81ff>lambda:InvokeFunction</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>Resource</span>: !<span style=color:#ae81ff>GetAtt ValidationFunction.Arn</span>
</span></span></code></pre></div><h3 id=configuring-compliant-runtimes---using-systems-manager-parameter-store>Configuring Compliant Runtimes - Using Systems Manager Parameter Store</h3><p>AWS Systems Manager Parameter Store is a secure, hierarchical service for managing configuration data and secrets, allowing users to store and retrieve data such as configuration, database strings, etc., in the form of parameter values.</p><p>In this specific example, we will utilize <strong>Parameter Store</strong> to store the list of allowed Lambda runtimes. This configuration value will be a <code>StringList</code> parameter containing a list of permitted runtimes, separated by commas. Below is a sample CloudFormation snippet defining the parameter:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Parameter Store Parameter</span>
</span></span><span style=display:flex><span><span style=color:#f92672>ConfigParameter</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::SSM::Parameter</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>Name</span>: !<span style=color:#ae81ff>Ref ParameterStoreParamName</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>StringList</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Value</span>: !<span style=color:#ae81ff>Ref ParameterStoreDefaultValue</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Description</span>: <span style=color:#e6db74>&#34;Configuration for Lambda Hook&#34;</span>
</span></span></code></pre></div><p>Note: The use of parameters in CloudFormation for the <code>Name</code> and <code>Value</code> attributes enables dynamic input when deploying the CloudFormation template.</p><h3 id=deploying-the-solution>Deploying the Solution</h3><p>To deploy this solution, you can use the <code>deploy.sh</code> script located in the root of the repository.</p><p>This script will perform the following steps:</p><ul><li>Compile and build the Validation Lambda function.</li><li>Create an Amazon S3 bucket to store the CloudFormation template.</li><li>Upload the CloudFormation template and Lambda source code to the S3 bucket.</li><li>Deploy the CloudFormation template.</li></ul><h3 id=testing-the-lambda-hook>Testing the Lambda Hook</h3><p>To test the CloudFormation Lambda Hook, you can deploy a simple CloudFormation template containing a &ldquo;Hello World&rdquo; Lambda function. First, test the Lambda function configured with a compliant runtime. Then, modify the template to configure the Lambda function with a non-compliant runtime.</p><p>Below is the initial definition of the CloudFormation template for testing:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Lambda Function</span>
</span></span><span style=display:flex><span><span style=color:#f92672>HelloWorldFunction</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Lambda::Function</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>FunctionName</span>: <span style=color:#ae81ff>hello-world-function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>nodejs22.x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>index.handler</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Role</span>: !<span style=color:#ae81ff>GetAtt LambdaExecutionRole.Arn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Code</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ZipFile</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        exports.handler = async (event, context) =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            console.log(&#39;Hello World!&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            const response = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                statusCode: 200,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                body: JSON.stringify(&#39;Hello World!&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            return response;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        };</span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>Timeout</span>: <span style=color:#ae81ff>30</span>
</span></span></code></pre></div><p>Note that the runtime value is <code>nodejs22.x</code>, which is currently within the list of allowed runtimes. Therefore, the expectation is that the deployment of this Lambda function will succeed.</p><p>Deploy this template using the AWS CLI:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws cloudformation deploy <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --template-file sample/template.yml <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --stack-name hook-test <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  --capabilities CAPABILITY_IAM
</span></span></code></pre></div><p>Check the <strong>CloudFormation Console</strong>:</p><p>As expected, the deployment will succeed. You can also verify that the CloudFormation Lambda Hook was triggered by checking <strong>CloudWatch Logs</strong>.</p><p>Now, edit the original template to set up a Lambda runtime not included in the list of permitted runtimes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-YAML data-lang=YAML><span style=display:flex><span><span style=color:#75715e># Lambda Function</span>
</span></span><span style=display:flex><span><span style=color:#f92672>HelloWorldFunction</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>Type</span>: <span style=color:#ae81ff>AWS::Lambda::Function</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>Properties</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>FunctionName</span>: <span style=color:#ae81ff>hello-world-function</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Runtime</span>: <span style=color:#ae81ff>nodejs18.x</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Handler</span>: <span style=color:#ae81ff>index.handler</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Role</span>: !<span style=color:#ae81ff>GetAtt LambdaExecutionRole.Arn</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>Code</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>ZipFile</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        exports.handler = async (event, context) =&gt; {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            console.log(&#39;Hello World!&#39;);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            const response = {
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                statusCode: 200,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                body: JSON.stringify(&#39;Hello World!&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            };
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            return response;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        };</span>        
</span></span><span style=display:flex><span>    <span style=color:#f92672>Timeout</span>: <span style=color:#ae81ff>30</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>MemorySize</span>: <span style=color:#ae81ff>128</span>
</span></span></code></pre></div><p>Deploy this template using the AWS CLI with the same command and check the CloudFormation Console:</p><p>As expected, the deployment will fail. The CloudFormation Lambda Hook was triggered, and since the Lambda runtime is not in the list of allowed runtimes, the deployment was blocked. You can also verify that the Hook failed in <strong>CloudWatch Logs</strong>.</p><h3 id=cleaning-up-resources>Cleaning Up Resources:</h3><p>To remove the resources related to the test template, you can run the <code>cleanup_sample.sh</code> script in the <strong>sample</strong> directory. This script will delete</p><p>To delete the resources related to the main solution described above (based on the AWS CloudFormation Lambda Hook), you can use the <code>cleanup.sh</code> script in the root folder of the repository. This script will perform the following tasks:</p><ul><li>Delete the CloudFormation Stack</li><li>Empty the S3 Bucket used for the deployment of the Stack</li><li>Delete the S3 Bucket</li></ul><h3 id=conclusion>Conclusion:</h3><p>In this article, you learned how to implement CloudFormation Hooks to ensure compliance with Lambda runtime across your entire AWS infrastructure. By leveraging the power of Lambda Hooks, you learned how to create a preventive control mechanism to validate Lambda runtime configurations before deployment.</p><p>By enabling Lambda Hooks and deploying a custom Lambda function for validation, you have established an automated process that ensures only compliant runtimes are used in your organization&rsquo;s Lambda functions when creating or updating CloudFormation Stacks. This solution can be easily integrated with popular development tools like AWS CLI, AWS SAM, CI/CD pipelines, and AWS CDK, helping streamline control implementation in your current workflows and eliminating the need for manual checks or post-deployment fixes.</p><p>The validation method presented in this article is not limited to Lambda runtimes but can be extended to other AWS resources supported by CloudFormation, enabling you to enforce governance policies across various infrastructure components in your AWS environment.</p><h3 id=about-the-authors>About the Authors:</h3><h4 id=matteo-luigi-restelli>Matteo Luigi Restelli</h4><p>Matteo Luigi Restelli is a Senior Partner Solutions Architect at AWS. He primarily works with AWS consulting partners in Italy and specializes in areas such as Infrastructure as Code, Cloud Native App Development, and DevOps. Outside of work, he enjoys swimming, rock & roll music, and learning new things every day, particularly in the field of Computer Science.</p><h4 id=stella-hie>Stella Hie</h4><p>Stella Hie is a Senior Product Manager Technical responsible for AWS Infrastructure as Code. She focuses on proactive control and governance, with the goal of providing customers with the best experience when using AWS solutions securely. Outside of work, she enjoys mountain climbing, playing the piano, and attending live shows.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/3.2-blog2/ title="Blog 2"><i class="fa fa-chevron-left"></i></a> <a class="nav nav-next" href=../../4-eventparticipated/ title="Events Participated" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765279076></script><script src=../../js/perfect-scrollbar.min.js?1765279076></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765279076></script><script src=../../js/jquery.sticky.js?1765279076></script><script src=../../js/featherlight.min.js?1765279076></script><script src=../../js/highlight.pack.js?1765279076></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765279076></script><script src=../../js/learn.js?1765279076></script><script src=../../js/hugo-learn.js?1765279076></script><link href=../../mermaid/mermaid.css?1765279076 rel=stylesheet><script src=../../mermaid/mermaid.js?1765279076></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>