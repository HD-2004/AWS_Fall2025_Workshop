<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.134.3"><meta name=description content><meta name=author content="hieudhse184340@fpt.edu.vn"><link rel=icon href=../../images/favicon.png type=image/png><title>Blog 1 :: Internship Report</title> <link href=../../css/nucleus.css?1765279076 rel=stylesheet><link href=../../css/fontawesome-all.min.css?1765279076 rel=stylesheet><link href=../../css/hybrid.css?1765279076 rel=stylesheet><link href=../../css/featherlight.min.css?1765279076 rel=stylesheet><link href=../../css/perfect-scrollbar.min.css?1765279076 rel=stylesheet><link href=../../css/auto-complete.css?1765279076 rel=stylesheet><link href=../../css/atom-one-dark-reasonable.css?1765279076 rel=stylesheet><link href=../../css/theme.css?1765279076 rel=stylesheet><link href=../../css/hugo-theme.css?1765279076 rel=stylesheet><link href=../../css/theme-workshop.css?1765279076 rel=stylesheet><script src=../../js/jquery-3.3.1.min.js?1765279076></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=../../3-blogstranslated/3.1-blog1/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=../../><svg id="Layer_1" data-name="Layer 1" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff}.cls-2{fill:#f90;fill-rule:evenodd}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09 10.85a4.7 4.7.0 00.19 1.48 7.73 7.73.0 00.54 1.19.77.77.0 01.12.38.64.64.0 01-.32.49l-1 .7a.83.83.0 01-.44.15.69.69.0 01-.49-.23 3.8 3.8.0 01-.6-.77q-.25-.42-.51-1a6.14 6.14.0 01-4.89 2.3 4.54 4.54.0 01-3.32-1.19 4.27 4.27.0 01-1.22-3.2 4.28 4.28.0 011.46-3.4A6.06 6.06.0 017.69 6.46a12.47 12.47.0 011.76.13q.92.13 1.91.36V5.73a3.65 3.65.0 00-.79-2.66A3.81 3.81.0 007.86 2.3a7.71 7.71.0 00-1.79.22 12.78 12.78.0 00-1.79.57 4.55 4.55.0 01-.58.22h-.26q-.35.0-.35-.52V2a1.09 1.09.0 01.12-.58 1.2 1.2.0 01.47-.35A10.88 10.88.0 015.77.32 10.19 10.19.0 018.36.0a6 6 0 014.35 1.35 5.49 5.49.0 011.38 4.09zM7.34 13.38a5.36 5.36.0 001.72-.31A3.63 3.63.0 0010.63 12 2.62 2.62.0 0011.19 11a5.63 5.63.0 00.16-1.44v-.7a14.35 14.35.0 00-1.53-.28 12.37 12.37.0 00-1.56-.1 3.84 3.84.0 00-2.47.67A2.34 2.34.0 005 11a2.35 2.35.0 00.61 1.76A2.4 2.4.0 007.34 13.38zm13.35 1.8a1 1 0 01-.64-.16 1.3 1.3.0 01-.35-.65L15.81 1.51a3 3 0 01-.15-.67.36.36.0 01.41-.41H17.7a1 1 0 01.65.16 1.4 1.4.0 01.33.65l2.79 11 2.59-11A1.17 1.17.0 0124.39.6a1.1 1.1.0 01.67-.16H26.4a1.1 1.1.0 01.67.16 1.17 1.17.0 01.32.65L30 12.39 32.88 1.25A1.39 1.39.0 0133.22.6a1 1 0 01.65-.16h1.54a.36.36.0 01.41.41 1.36 1.36.0 010 .26 3.64 3.64.0 01-.12.41l-4 12.86a1.3 1.3.0 01-.35.65 1 1 0 01-.64.16H29.25a1 1 0 01-.67-.17 1.26 1.26.0 01-.32-.67L25.67 3.64l-2.56 10.7a1.26 1.26.0 01-.32.67 1 1 0 01-.67.17zm21.36.44a11.28 11.28.0 01-2.56-.29 7.44 7.44.0 01-1.92-.67 1 1 0 01-.61-.93v-.84q0-.52.38-.52a.9.9.0 01.31.06l.42.17a8.77 8.77.0 001.83.58 9.78 9.78.0 002 .2 4.48 4.48.0 002.43-.55 1.76 1.76.0 00.86-1.57 1.61 1.61.0 00-.45-1.16A4.29 4.29.0 0043 9.22l-2.41-.76A5.15 5.15.0 0138 6.78a3.94 3.94.0 01-.83-2.41 3.7 3.7.0 01.45-1.85 4.47 4.47.0 011.19-1.37 5.27 5.27.0 011.7-.86A7.4 7.4.0 0142.6.0a8.87 8.87.0 011.12.07q.57.07 1.08.19t.95.26a4.27 4.27.0 01.7.29 1.59 1.59.0 01.49.41.94.94.0 01.15.55v.79q0 .52-.38.52a1.76 1.76.0 01-.64-.2 7.74 7.74.0 00-3.2-.64 4.37 4.37.0 00-2.21.47 1.6 1.6.0 00-.79 1.48 1.58 1.58.0 00.49 1.18 4.94 4.94.0 001.83.92L44.55 7a5.08 5.08.0 012.57 1.6A3.76 3.76.0 0147.9 11a4.21 4.21.0 01-.44 1.93 4.4 4.4.0 01-1.21 1.47 5.43 5.43.0 01-1.85.93A8.25 8.25.0 0142.05 15.62z"/><path class="cls-2" d="M45.19 23.81C39.72 27.85 31.78 30 25 30A36.64 36.64.0 01.22 20.57c-.51-.46-.06-1.09.56-.74A49.78 49.78.0 0025.53 26.4 49.23 49.23.0 0044.4 22.53C45.32 22.14 46.1 23.14 45.19 23.81z"/><path class="cls-2" d="M47.47 21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74 3.13-2.2 8.27-1.57 8.86-.83s-.16 5.89-3.09 8.35c-.45.38-.88.18-.68-.32C46.69 25.8 48.17 22.11 47.47 21.21z"/></svg></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label> <input data-search-input id=search-by type=search placeholder=Search...> <span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../../js/lunr.min.js?1765279076></script><script type=text/javascript src=../../js/auto-complete.js?1765279076></script><script type=text/javascript>var baseurl="https://hd-2004.github.io/AWS_Fall2025_Workshop/"</script><script type=text/javascript src=../../js/search.js?1765279076></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-worklog/ title=Worklog class=dd-item><a href=../../1-worklog/><b>1. </b>Worklog
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/1-worklog/1.1-week1/ title="Week 1 Worklog" class=dd-item><a href=../../1-worklog/1.1-week1/><b>1.1. </b>Week 1 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.2-week2/ title="Week 2 Worklog" class=dd-item><a href=../../1-worklog/1.2-week2/><b>1.2. </b>Week 2 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.3-week3/ title="Week 3 Worklog" class=dd-item><a href=../../1-worklog/1.3-week3/><b>1.3. </b>Week 3 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.4-week4/ title="Week 4 Worklog" class=dd-item><a href=../../1-worklog/1.4-week4/><b>1.4. </b>Week 4 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.5-week5/ title="Week 5 Worklog" class=dd-item><a href=../../1-worklog/1.5-week5/><b>1.5. </b>Week 5 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.6-week6/ title="Week 6 Worklog" class=dd-item><a href=../../1-worklog/1.6-week6/><b>1.6. </b>Week 6 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.7-week7/ title="Week 7 Worklog" class=dd-item><a href=../../1-worklog/1.7-week7/><b>1.7. </b>Week 7 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.8-week8/ title="Week 8 Worklog" class=dd-item><a href=../../1-worklog/1.8-week8/><b>1.8. </b>Week 8 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.9-week9/ title="Week 9 Worklog" class=dd-item><a href=../../1-worklog/1.9-week9/><b>1.9. </b>Week 9 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.10-week10/ title="Week 10 Worklog" class=dd-item><a href=../../1-worklog/1.10-week10/><b>1.10. </b>Week 10 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.11-week11/ title="Week 11 Worklog" class=dd-item><a href=../../1-worklog/1.11-week11/><b>1.11. </b>Week 11 Worklog
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/1-worklog/1.12-week12/ title="Week 12 Worklog" class=dd-item><a href=../../1-worklog/1.12-week12/><b>1.12. </b>Week 12 Worklog
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/2-proposal/ title=Proposal class=dd-item><a href=../../2-proposal/><b>2. </b>Proposal
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/ title="Translated Blogs" class="dd-item
parent"><a href=../../3-blogstranslated/><b>3. </b>Translated Blogs
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/3-blogstranslated/3.1-blog1/ title="Blog 1" class="dd-item
active"><a href=../../3-blogstranslated/3.1-blog1/><b>3.1. </b>Blog 1
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.2-blog2/ title="Blog 2" class=dd-item><a href=../../3-blogstranslated/3.2-blog2/><b>3.2. </b>Blog 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/3-blogstranslated/3.3-blog3/ title="Blog 3" class=dd-item><a href=../../3-blogstranslated/3.3-blog3/><b>3.3. </b>Blog 3
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/4-eventparticipated/ title="Events Participated" class=dd-item><a href=../../4-eventparticipated/><b>4. </b>Events Participated
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/4-eventparticipated/4.5-event5/ title="Event 5" class=dd-item><a href=../../4-eventparticipated/4.5-event5/><b>4.5. </b>Event 5
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.4-event4/ title="Event 4" class=dd-item><a href=../../4-eventparticipated/4.4-event4/><b>4.4. </b>Event 4
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.3-event3/ title="Event 3" class=dd-item><a href=../../4-eventparticipated/4.3-event3/><b>4.3. </b>Event 3
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.2-event2/ title="Event 2" class=dd-item><a href=../../4-eventparticipated/4.2-event2/><b>4.2. </b>Event 2
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/4-eventparticipated/4.1-event1/ title="Event 1" class=dd-item><a href=../../4-eventparticipated/4.1-event1/><b>4.1. </b>Event 1
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/5-workshop/ title=Workshop class=dd-item><a href=../../5-workshop/><b>5. </b>Workshop
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/5-workshop/5.1-workshop-overview/ title=Introduction class=dd-item><a href=../../5-workshop/5.1-workshop-overview/><b>5.1. </b>Introduction
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.2-prerequiste/ title=Prerequiste class=dd-item><a href=../../5-workshop/5.2-prerequiste/><b>5.2. </b>Prerequiste
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.3-create-amplify/ title="Create Amplify backend" class=dd-item><a href=../../5-workshop/5.3-create-amplify/><b>5.3. </b>Create Amplify backend
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.4-aws-cognito/ title="Configure AWS Cognito" class=dd-item><a href=../../5-workshop/5.4-aws-cognito/>5.4. Configure AWS Cognito
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.5-create-ses/ title="Configure Amazon SES for email" class=dd-item><a href=../../5-workshop/5.5-create-ses/><b>5.5. </b>Configure Amazon SES for email
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.6-create-cloudwatch/ title="Configure Amazon CloudWatch" class=dd-item><a href=../../5-workshop/5.6-create-cloudwatch/><b>5.6. </b>Configure Amazon CloudWatch
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.7-create-iam-roles-policies/ title="Create IAM Roles-Policies" class=dd-item><a href=../../5-workshop/5.7-create-iam-roles-policies/><b>5.7. </b>Create IAM Roles-Policies
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.8-route-53/ title="Configure Amazon Route 53" class=dd-item><a href=../../5-workshop/5.8-route-53/><b>5.8. </b>Configure Amazon Route 53
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/5-workshop/5.9-cleanup/ title="Clean up" class=dd-item><a href=../../5-workshop/5.9-cleanup/><b>5.9. </b>Clean up
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/6-self-evaluation/ title=Self-Assessment class=dd-item><a href=../../6-self-evaluation/><b>6. </b>Self-Assessment
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/7-feedback/ title="Feedback & Suggestions" class=dd-item><a href=../../7-feedback/><b>7. </b>Feedback & Suggestions
<i class="fas fa-check read-icon"></i></a></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://www.facebook.com/groups/awsstudygroupfcj/><i class='fab fa-facebook'></i> AWS Study Group</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value"><option id=en value=https://hd-2004.github.io/AWS_Fall2025_Workshop/3-blogstranslated/3.1-blog1/ selected>English</option><option id=vi value=https://hd-2004.github.io/AWS_Fall2025_Workshop/vi/3-blogstranslated/3.1-blog1/>Tiếng Việt</option></select><svg id="Capa_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><polygon points="0,63.75 127.5,191.25 255,63.75"/></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i> Clear History</a></li></ul></section><section id=footer><left><b>Workshop</b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title=Migrate alt="web counter" border=0></a><br><b><a href=https://cloudjourney.awsstudygroup.com/>Cloud Journey</a></b><br><img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" alt="web counter" border=0>
</left><left><br><br><b>Last Updated</b><br><i><span id=lastUpdated style=color:orange></span>
</i><script>const today=new Date,formattedDate=today.toLocaleDateString("en-GB");document.getElementById("lastUpdated").textContent=formattedDate</script></left><left><br><br><b>Team</b><br><i><a href=https://www.facebook.com/groups/660548818043427 style=color:orange>First Cloud Journey</a><br></i></left><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i> </a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span> <span class=links><a href=../../>Internship Report</a> > <a href=../../3-blogstranslated/>Translated Blogs</a> > Blog 1</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li></li><li><a href=#solution-overview>Solution Overview</a></li><li><a href=#how-it-works>How it Works</a></li><li><a href=#key-components>Key Components:</a></li><li><a href=#architecture-flow>Architecture Flow:</a></li><li><a href=#observations>Observations:</a></li><li><a href=#building-your-telephony-application>Building Your Telephony Application:</a></li><li><a href=#deployment-guide>Deployment Guide</a></li><li><a href=#key-benefits>Key Benefits</a></li><li><a href=#solution-deployment>Solution Deployment</a></li><li><a href=#follow-these-steps-to-deploy-the-cdk-stack>Follow these steps to deploy the CDK stack:</a></li><li><a href=#clean-up-resources>Clean Up Resources</a></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Blog 1</h1><h1 id=visually-build-telephony-applications-with-aws-step-functions>Visually build telephony applications with AWS Step Functions</h1><h4 id=author-reynaldo-hidalgo--march-17-2025--in-amazon-chime-sdk-application-services-architecture-aws-step-functions-best-practices-business-productivity-contact-center-technical-how-to>Author: Reynaldo Hidalgo | March 17, 2025 | in Amazon Chime SDK, Application Services, Architecture, AWS Step Functions, Best Practices, Business Productivity, Contact Center, Technical How-to</h4><p>Developers face several challenges when building telephony applications: managing unpredictable user responses, handling disconnects, processing incorrect input data, and resolving errors. These challenges extend development cycles and result in unstable applications that fail to meet user expectations.</p><p>This article explains how Amazon Web Services (AWS) Step Functions, combined with the Amazon Chime SDK Public Switched Telephone Network (PSTN) audio service, provides a solution to overcome these challenges.</p><h3 id=solution-overview>Solution Overview</h3><p>To illustrate the solution, we built a sample telephony application that allows business owners to manage customer calls through a dedicated business phone number. This solution helps small business owners separate personal and business communications while managing all calls from their existing phone.</p><p>The beta version of this sample application offers six core call flows:</p><ol><li><strong>During business hours</strong>: Forward incoming customer calls to the business owner</li><li><strong>After business hours</strong>: Allow customers to leave voicemail</li><li><strong>Retrieve voicemail</strong>: Allow the business owner to access customer voicemail</li><li><strong>Business caller ID</strong>: Allow the business owner to call customers using the business phone number</li><li><strong>Schedule a call</strong>: Allow the business owner to schedule calls with customers for later in the day</li><li><strong>Automated calling</strong>: Automatically initiate scheduled calls between the business owner and the customer</li></ol><p>Using Workflow Studio, we built a Step Functions workflow that handles all six call flows and manages unexpected scenarios.</p><h3 id=how-it-works>How it Works</h3><p>AWS Step Functions enables flexible, visual workflow design through pre-built components and error-handling rules. This creates workflows that include event-driven states, allowing the input, processing, and output of JavaScript Object Notation (JSON) formatted messages. The PSTN audio service streamlines telephony applications through a serverless approach using a request/response programming model. This service invokes AWS Lambda functions with Events and waits for Action responses, both of which are in a pre-defined JSON format. This common JSON format allows seamless integration between the PSTN audio service and Step Functions, leading us to design a serverless architecture (Figure 2) that allows two-way JSON message exchange between the two services.</p><h3 id=key-components>Key Components:</h3><ul><li><strong>eventRouter</strong>: A Lambda function that manages the JSON message exchange</li><li><strong>appWorkflow</strong>: Step functions that implement the call flow logic</li><li><strong>actionsQueue</strong>: An Amazon Simple Queue Service (Amazon SQS) queue that stores response actions</li></ul><h3 id=architecture-flow>Architecture Flow:</h3><ol><li>The PSTN audio service receives an incoming call</li><li>The service sends a NEW_INBOUND_CALL event to the eventRouter</li><li>The eventRouter creates the actionsQueue</li><li>The eventRouter executes the appWorkflow asynchronously with event data</li><li>The eventRouter starts sending long notifications from the actionsQueue, waiting for the next action notification</li><li>The appWorkflow processes the event data in JSON format, calculating the next action</li><li>The appWorkflow queues the next action using Amazon SQS SendMessage API with the Wait for Callback integration model, using a task token to pause the workflow until the next event call is received</li><li>The eventRouter retrieves and removes the action from the actionsQueue</li><li>The eventRouter returns the action to the PSTN audio service</li></ol><h3 id=observations>Observations:</h3><ul><li>The eventRouter logic is generic and independent of specific calls and other Step Function workflows</li><li>The eventRouter queries an environment variable to determine which workflow to call.
The actionQueue and appWorkflow instances persist throughout each call.</li><li>The eventRouter is responsible for creating and deleting each actionsQueue.</li><li>The appWorkflow instances are created by the eventRouter at the start of each call.</li><li>The appWorkflow instances complete execution when all call participants hang up.</li></ul><h3 id=building-your-telephony-application>Building Your Telephony Application:</h3><h4 id=prerequisites>Prerequisites</h4><ul><li>Familiarity with developing workflows in Step Functions Workflow Studio</li><li>Access to the AWS Management Console</li></ul><h3 id=deployment-guide>Deployment Guide</h3><ul><li><p>Create a dedicated Step Functions workflow for each telephony application</p></li><li><p>Design and deploy the workflow using Workflow Studio</p></li><li><p>Use the Standard workflow type to support long-duration calls</p></li><li><p>Update the environment variable &ldquo;CallFlowsDIDMap&rdquo; in the eventRouter Lambda function to map phone numbers to their corresponding workflows’ Amazon Resource Names (ARN)</p></li><li><p>Set the workflow variable in the &ldquo;Initialization&rdquo; state tab (Figure 3). The eventRouter function automatically sets the &ldquo;QueueUrl&rdquo;, and adding other variables here eliminates the need for external storage</p></li><li><p>Configure Choice state rules to route calls based on conditions. Rules one to three (Figure 4) manage call routing based on inbound/outbound direction and the caller/customer identity, while the default rule handles unexpected scenarios.</p></li><li><p>Configure the SQS state: SendMessage (Figure 5) to guide the PSTN audio service’s next action by:
Formatting the message content to match supported actions for the PSTN audio service
Setting TransactionAttributes to pass the “WaitToken” and “QueueUrl” values throughout the call
Triggering the &ldquo;Wait for Callback with Task Token&rdquo; integration model</p></li><li><p>Leverage AWS service integration states to interact with other AWS services directly from the workflow.</p></li></ul><p>Example: Use the DynamoDB PutItem state (Figure 6) to store Amazon Simple Storage Service (Amazon S3) recorded files, including the name and bucket key, in DynamoDB.</p><ul><li>Use JSONata expressions (Figure 7) to minimize the number of Lambda functions.</li></ul><p>Example: For Amazon EventBridge scheduling, calculate time expressions using the JSONata functions [$fromMillis(), $millis(), number()] and concatenate strings to handle customer call scheduling.</p><h3 id=key-benefits>Key Benefits</h3><p>This approach to building telephony applications offers several advantages:</p><ol><li>Workflow designer based on a visual process</li><li>Self-recording call flow logic</li><li>Version management and publishing</li><li>Native integration with AWS Services</li><li>Visual logs and debugging for each call</li><li>Automatic scaling</li><li>Pay-as-you-go pricing</li></ol><h3 id=solution-deployment>Solution Deployment</h3><p>The following steps allow you to deploy the sample telephony application along with a serverless architecture (Figure 2).</p><h4 id=prerequisites-1>Prerequisites</h4><ol><li>Access to the AWS Management Console</li><li>Install Node.js and npm</li><li>Install and configure the AWS Command Line Interface (AWS CLI)</li></ol><h4 id=deployment-guide-1>Deployment Guide:</h4><p>The AWS Cloud Development Kit (CDK) project in AWS’s GitHub repository will deploy the following resources:</p><ul><li><strong>phoneNumberBusiness</strong> – The business phone number provided for the sample application</li><li><strong>sipMediaApp</strong> – The SIP media application that routes calls to - lambdaProcessPSTNAudioServiceCalls</li><li><strong>sipRule</strong> – SIP rule that forwards calls from phoneNumberBusiness to sipMediaApp</li><li><strong>stepfunctionBusinessProxyWorkflow</strong> – Step Functions workflow for the sample app</li><li><strong>roleStepfuntionBusinessProxyWorkflow</strong> – IAM role for - stepfunctionBusinessProxyWorkflow</li><li><strong>lambdaProcessPSTNAudioServiceCalls</strong> – Lambda function to process the call</li><li><strong>roleLambdaProcessPSTNAudioServiceCalls</strong> – IAM role for - lambdaProcessPSTNAudioServiceCalls</li><li><strong>dynamoDBTableBusinessVoicemails</strong> – DynamoDB table to store customer voicemail</li><li><strong>s3BucketApp</strong> – S3 bucket to store system recordings and customer voicemails</li><li><strong>s3BucketPolicy</strong> – IAM policy granting PSTN audio service access to - s3BucketApp</li><li><strong>lambdaOutboundCall</strong> – Lambda function to schedule calls with customers</li><li><strong>roleLambdaOutboundCall</strong> – IAM role for lambdaOutboundCall</li><li><strong>roleEventBridgeLambdaCall</strong> – IAM role that allows EventBridge service to invoke lambdaOutboundCall</li></ul><h3 id=follow-these-steps-to-deploy-the-cdk-stack>Follow these steps to deploy the CDK stack:</h3><ol><li>Clone the repository</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/aws-samples/amazon-chime-sdk-visual-media-applications  
</span></span><span style=display:flex><span>cd amazon-chime-sdk-visual-media-applications  
</span></span><span style=display:flex><span>npm install  
</span></span></code></pre></div><ol start=2><li>Bootstrap the stack</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#default AWS CLI credentials are used, otherwise use the –-profile parameter  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#provide the &lt;account-id&gt; and &lt;region&gt; to deploy this stack  </span>
</span></span><span style=display:flex><span>cdk bootstrap aws://&lt;account-id&gt;/&lt;region&gt;  
</span></span></code></pre></div><ol start=3><li>Deploy the stack</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#default AWS CLI credentials are used, otherwise use the –-profile parameter  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#personalNumber: the personal phone number of the business owner in E.164 format  </span>
</span></span><span style=display:flex><span><span style=color:#75715e>#businessAreaCode: the United States area code used to provision the business number  </span>
</span></span><span style=display:flex><span>cdk deploy –-context personalNumber<span style=color:#f92672>=</span>+1NPAXXXXXXX –-context businessAreaCode<span style=color:#f92672>=</span>NPA  
</span></span></code></pre></div><p>Call the provided phone number to test the sample application. Optionally, edit the workflow to update the business name and business hours in the &ldquo;Initialization&rdquo; Task state in the Variables tab.</p><h3 id=clean-up-resources>Clean Up Resources</h3><p>To clean up this test, run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cdk destroy  
</span></span></code></pre></div><p>This blog demonstrates how combining AWS Step Functions and the Amazon Chime SDK’s PSTN audio service simplifies the development of reliable telephony applications through visual workflow design and error management. We provided a sample application, implementing six core features for business telephony, illustrating how this solution effectively manages multiple conditional paths and exceptions such as disconnects and invalid inputs.
The serverless architecture created enables seamless integration between the two services via JSON-based communication, providing automatic scaling</p><p><strong>TAGS:</strong> best practices, customer engagement, Messaging and Targeting</p><p><strong>About the Author</strong></p><p><strong>Reynaldo Hidalgo</strong></p><p>Reynaldo is a Cloud Solutions Architect at AWS, with over 20 years of experience in software, database, and business intelligence decryption, as well as call center/telephony infrastructure and applications. He is also a co-founder of PrimeVoiX, a startup focused on international contact center solutions.</p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../../3-blogstranslated/ title="Translated Blogs"><i class="fa fa-chevron-left"></i></a> <a class="nav nav-next" href=../../3-blogstranslated/3.2-blog2/ title="Blog 2" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../../js/clipboard.min.js?1765279076></script><script src=../../js/perfect-scrollbar.min.js?1765279076></script><script src=../../js/perfect-scrollbar.jquery.min.js?1765279076></script><script src=../../js/jquery.sticky.js?1765279076></script><script src=../../js/featherlight.min.js?1765279076></script><script src=../../js/highlight.pack.js?1765279076></script><script>hljs.initHighlightingOnLoad()</script><script src=../../js/modernizr.custom-3.6.0.js?1765279076></script><script src=../../js/learn.js?1765279076></script><script src=../../js/hugo-learn.js?1765279076></script><link href=../../mermaid/mermaid.css?1765279076 rel=stylesheet><script src=../../mermaid/mermaid.js?1765279076></script><script>mermaid.initialize({startOnLoad:!0})</script><script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,(e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date),(i=t.createElement(n),a=t.getElementsByTagName(n)[0]),i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-158079754-2","auto"),ga("send","pageview")</script></body></html>